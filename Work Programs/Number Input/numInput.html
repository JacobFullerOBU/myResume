<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number List to CSV</title>
    <style>
        #numberList li {
            margin-bottom: 10px;
        }
        /* Styling for the top-right image */
        .top-right-image {
            position: fixed; /* Stays in place even when scrolling */
            top: 10px;
            right: 10px;
            width: 400px; /* Adjust width as needed */
            height: auto;
        }
    </style>
</head>
<body>
    <!-- Image positioned in the top-right corner -->
    <img src="../unionlogo.png" alt="Top Right Image" class="top-right-image">

    <h1>Enter a number and press "Add"</h1>

    <form id="numberForm">
        <input type="number" id="numberInput" required>
        <button type="submit">Add</button>
    </form>

    <h3>Search:</h3>
    <input type="text" id="searchInput" placeholder="Search number...">

    <h3>Numbers List:</h3>
    <ul id="numberList"></ul>

    <button id="sortAsc">Sort Ascending</button>
    <button id="sortDesc">Sort Descending</button>
    
    <button id="generateCSV" style="display: none;">Generate CSV and Email</button>

    <script src="https://smtpjs.com/v3/smtp.js"></script> <!-- For sending emails -->
    <script>
        let numberArray = [];

        // Handle form submission
        document.getElementById('numberForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const numberInput = document.getElementById('numberInput').value;

            // Add number to list
            numberArray.push(Number(numberInput));
            updateNumberList();

            // Clear input
            document.getElementById('numberInput').value = '';

            // Show CSV button once there is at least one number
            if (numberArray.length > 0) {
                document.getElementById('generateCSV').style.display = 'block';
            }
        });

        // Update number list on the page
        function updateNumberList(filteredArray = numberArray) {
            const list = document.getElementById('numberList');
            list.innerHTML = '';
            filteredArray.forEach((num, index) => {
                const listItem = document.createElement('li');
                listItem.textContent = num;

                // Create Edit button
                const editButton = document.createElement('button');
                editButton.textContent = 'Edit';
                editButton.style.marginLeft = '10px';
                editButton.addEventListener('click', function() {
                    editNumber(index);
                });

                // Create Delete button
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.style.marginLeft = '10px';
                deleteButton.addEventListener('click', function() {
                    deleteNumber(index);
                });

                listItem.appendChild(editButton);
                listItem.appendChild(deleteButton);
                list.appendChild(listItem);
            });
        }

        // Edit a number in the list
        function editNumber(index) {
            const newValue = prompt('Enter the new number:', numberArray[index]);
            if (newValue !== null && newValue !== '') {
                numberArray[index] = Number(newValue);
                updateNumberList();
            }
        }

        // Delete a number from the list
        function deleteNumber(index) {
            numberArray.splice(index, 1); // Remove the number at the specified index
            updateNumberList();

            // Hide CSV button if the list is empty
            if (numberArray.length === 0) {
                document.getElementById('generateCSV').style.display = 'none';
            }
        }

        // Sort Ascending
        document.getElementById('sortAsc').addEventListener('click', function() {
            numberArray.sort((a, b) => a - b);
            updateNumberList();
        });

        // Sort Descending
        document.getElementById('sortDesc').addEventListener('click', function() {
            numberArray.sort((a, b) => b - a);
            updateNumberList();
        });

        // Search Functionality
        document.getElementById('searchInput').addEventListener('input', function() {
            const query = this.value.toLowerCase();
            const filteredArray = numberArray.filter(num => num.toString().includes(query));
            updateNumberList(filteredArray);
        });

        // Handle CSV generation and emailing
        document.getElementById('generateCSV').addEventListener('click', function() {
            // Convert array to CSV
            let csvContent = "data:text/csv;charset=utf-8," + numberArray.join(",\n");
            let encodedUri = encodeURI(csvContent);
            let link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "number_list.csv");
            document.body.appendChild(link); // Required for Firefox

            // Automatically download the CSV file
            link.click();

            // Now send the email with the CSV attached (using SMTP.js or EmailJS)
            sendEmailWithAttachment(encodedUri);
        });

        // Function to send the email (using SMTP.js for example)
        function sendEmailWithAttachment(csvDataUrl) {
            Email.send({
                SecureToken: "YOUR_SMTPJS_TOKEN", // Replace with your SMTPJS token
                To: "your-email@example.com",  // Replace with your email
                From: "sender-email@example.com", // Replace with a valid sender email
                Subject: "Number List CSV",
                Body: "Here is your CSV file with the numbers you entered.",
                Attachments: [
                    {
                        name: "number_list.csv",
                        data: csvDataUrl
                    }
                ]
            }).then(
                message => alert(message)
            );
        }
    </script>
</body>
</html>
